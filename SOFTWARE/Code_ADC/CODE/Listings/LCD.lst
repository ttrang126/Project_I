C51 COMPILER V9.60.7.0   LCD                                                               07/13/2023 10:09:55 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN .\Objects\LCD.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE LCD.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\LCD.l
                    -st) TABS(2) OBJECT(.\Objects\LCD.obj)

line level    source

   1          #include <REGX51.H>
   2          #include<stdio.h>
   3          
   4           sfr LCD = 0x80;
   5           sbit RS = P0^1;
   6           sbit RW = P0^2;
   7           sbit EN = P0^3;
   8           sbit A = P2^1;
   9           sfr ADC0804_Data = 0x90;
  10          sbit ADC0804_RD = P3^4;
  11          sbit ADC0804_WR = P3^3;
  12          sbit ADC0804_INTR = P3^2;
  13          
  14          unsigned char ADC0804_Read(void)
  15          {
  16   1        unsigned char result;
  17   1        
  18   1        
  19   1        ADC0804_WR = 0;
  20   1        ADC0804_WR = 1;
  21   1        
  22   1        while(ADC0804_INTR);
  23   1        
  24   1        ADC0804_RD = 0;
  25   1        result = ADC0804_Data;
  26   1        ADC0804_RD = 1;
  27   1        
  28   1        
  29   1        return result;
  30   1      }
  31          
  32          float Cal_Temp(unsigned int ADC_Value)
  33          {
  34   1        float Temperature1 = 0.0;
  35   1        unsigned int frac = 0;
  36   1        unsigned int temp = 0;
  37   1          Temperature1 = (400*ADC_Value)/(1004.45-0.78*ADC_Value);
  38   1          return Temperature1;
  39   1      }
  40          
  41          void delay(unsigned int ms)
  42          {
  43   1          int i,j;
  44   1          for(i = 0; i < ms; i++)
  45   1          {
  46   2              for(j = 0; j < 123; j++);
  47   2      
  48   2          }
  49   1      }
  50          void sendHigh(unsigned char Data){
  51   1          LCD = LCD & 0x0F; // XOA 4 BIT CA0 VA GIU LAI 4 BIT THAP
  52   1        LCD |= ( Data & 0xF0 );// LAY 4 BIT CAO
  53   1      }
  54          
C51 COMPILER V9.60.7.0   LCD                                                               07/13/2023 10:09:55 PAGE 2   

  55          void sendLow(unsigned char Data)
  56          {
  57   1          LCD = LCD & (0x0F);
  58   1          LCD = LCD | (Data << 4); // LAY 4 BIT THAP CUA DATA
  59   1      }
  60          
  61          void LCD_Enable(void)
  62          {
  63   1          EN = 0; // LCD NHAN DU LIEU
  64   1          delay(3);
  65   1          EN = 1; // LCD NGUNG NHAN DU LIEU
  66   1          delay(1);
  67   1      
  68   1      }
  69          
  70          void sendCMD(unsigned char cmd)
  71          
  72          {
  73   1          RW = 0; // LCD O CHE DO WRITE
  74   1          RS = 0; //LCD GUI LENH
  75   1          
  76   1          sendHigh(cmd);
  77   1          LCD_Enable();
  78   1          sendLow(cmd);
  79   1          LCD_Enable();
  80   1      }
  81          
  82          void sendData(unsigned char Data)
  83          {
  84   1          RW = 0; // LCD WRITE
  85   1          RS = 1; // LCD GUI DATA
  86   1      
  87   1          sendHigh(Data);
  88   1          LCD_Enable();
  89   1          sendLow(Data);
  90   1          LCD_Enable();
  91   1      }
  92          
  93          void LCD_Init(void)
  94          {
  95   1          delay(50); // LCD ON
  96   1          sendCMD(0x01); // xoa toan bo noi dung tren LCD 
  97   1          delay(5);
  98   1          sendCMD(0x02); // di chuyen con tro ve phia dau man hinh
  99   1          delay(5);
 100   1          sendCMD(0x28); // Giao tiep 4bit, hien thi 2 dong, kich thuoc 5x7
 101   1          delay(5);
 102   1          sendCMD(0x06); // Tu dong tanwg Cursoe den vi tri tiep thep
 103   1          delay(5);
 104   1          sendCMD(0x0C); // LCD ON Cursor OFF
 105   1          delay(5);
 106   1          sendCMD(0x0E); // LCD ON Cursor ON
 107   1          delay(5);
 108   1          sendCMD(0x80); // di chuyen Cursor ve dau dong 1
 109   1          delay(5);
 110   1      
 111   1      }
 112          
 113          void LCD_clear()
 114           {
 115   1           sendCMD(0x01);
 116   1       }
C51 COMPILER V9.60.7.0   LCD                                                               07/13/2023 10:09:55 PAGE 3   

 117          
 118          void SetCursor(unsigned short x, unsigned short y)
 119          {
 120   1          if(y == 0) 
 121   1          {
 122   2              sendCMD((x & 0x0F) | 0x80);
 123   2          }
 124   1          else if(y == 1)
 125   1              sendCMD((x & 0x0F) | 0xC0); // cursor xuong dong 2
 126   1      }
 127          
 128          void printChar(char c)
 129          {
 130   1          sendData(c);
 131   1      }
 132          
 133          void printString(char *c)
 134          {
 135   1          while(*c)
 136   1          {
 137   2              printChar(*c++);
 138   2          }
 139   1      }
 140          
 141          void main()
 142          {
 143   1        unsigned int ADC_Value = 0;
 144   1        double Temperature = 0;
 145   1        unsigned char a[5];
 146   1        LCD_Init(); 
 147   1        printString("Temp");
 148   1      delay(1000);
 149   1      LCD_clear();  
 150   1        while(1)
 151   1        {
 152   2                           //Khoi tao LCD
 153   2          A = 1;
 154   2          ADC_Value = ADC0804_Read();
 155   2          Temperature = Cal_Temp(ADC_Value);
 156   2          sprintf(a, "%3.1f", Temperature);
 157   2          printString("Temp:");
 158   2          printString(a);
 159   2          delay(5000);
 160   2          LCD_clear();
 161   2        
 162   2        }
 163   1         
 164   1      
 165   1      
 166   1      }
 167          
 168          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    451    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      22
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.60.7.0   LCD                                                               07/13/2023 10:09:55 PAGE 4   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
